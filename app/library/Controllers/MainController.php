<?php

/* DO NOT EDIT THIS FILE */

class MainController 
{

	protected $view;
	protected $variables;
	public function __construct()
	{
		$this->variables = array();
	}
	public function renderView($view, $variables=array())
	{
		foreach ($variables as $var_name=>$value)
		{	
			$$var_name = $value;
		}
		if (file_exists("../app/views/$view.php"))
		{
			ob_start();
			include "../app/views/$view.php";
			$file_contents = ob_get_contents();
			ob_end_clean();

			// Parse the file for blade-esque terms
			$file_contents = str_replace('}}', ';?>', $file_contents);
			$file_contents = str_replace('{{', '<?=', $file_contents);

			$startTemplate = strpos($file_contents, "@extends('")+10;
			$endtemplate = strpos($file_contents, "')", $startTemplate)-2;
			$template = substr($file_contents, $startTemplate, ($endtemplate-$startTemplate)+2);

			$templateString = "@extends('".$template."')";
			$file_contents = str_replace($templateString, "", $file_contents);
			$templateFile = "../app/views/$template.php";
			$templateContents = file_get_contents($templateFile);
			// Search the template file for yield('content')
			$file_contents = str_replace("@yield('content')", $file_contents, $templateContents);
			$file_contents = str_replace('}}', ';?>', $file_contents);
			$file_contents = str_replace('{{', '<?=', $file_contents);

			file_put_contents("../cache/tmp/temp.php", $file_contents);
			include "../cache/tmp/temp.php";
		}
		else {
			// Enter your view not found page here...
			echo 'View not found';
			die();
		}
	}
	public function redirect($controllerAction)
	{

		global $route;
		include "../index.php";
		// Find the Route associated with the Controller
		$url = WEBROOT.$route->searchByControllerAction($controllerAction);

		header("location: $url");
		/*
		$controllerAction = explode('@', $controllerAction);
		$controller = $controllerAction[0];
		$action = $controllerAction[1];
		if (class_exists($controller))
		{
			$controller = new $controller;
			$controller->$action();
		}
		else {
			include "../app/controllers/$controller.php";
			$controller = new $controller;
			$controller->$action();
		}
		*/

	}
}